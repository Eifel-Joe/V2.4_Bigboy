#####################################################################
#    Homing definition
#####################################################################
[homing_override]
axes: xyz
set_position_z: 0
gcode:
  ##### get user defines #####
  {% set max = {'x' : printer.configfile.config["stepper_x"]["position_max"]|float,'y' : printer.configfile.config["stepper_y"]["position_max"]|float} %}
  {% set probe_offset = {'x' : printer.configfile.settings.probe.x_offset|float,'y' : printer.configfile.settings.probe.y_offset|float} %}
  {% set center = {'x' : (max.x / 2) - probe_offset.x - 1,'y' : (max.y / 2) - probe_offset.y - 2} %}
  ##### end of definitions #####
  SAVE_GCODE_STATE NAME=HOMING_state
  STATUS_HOMING
  _SET_CURRENT VAL=HOME
  G91                            ; relative positioning
  G0 Z10 F1500
  G28 X
  G0 X-5
  G4 P2000
  G28 Y
  G0 Y-5
  _SET_CURRENT
  G90
  ##	XY Location of the Z Endstop Switch
  G0 X{center.x} Y{center.y} F12000
  G28 Z                          ; home Z
  G0 Z10 F1500                   ; move up
  _STATUS_BUTTON_READY BUTTON=4
  STATUS_READY
  RESTORE_GCODE_STATE NAME=HOMING_state